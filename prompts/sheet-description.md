# Developer Brief: Google Ads Data Integration for React Next.js App

## Data Source Overview
Your Next.js app integrates with Google Sheets data generated by our Google Ads script. The sheet contains two tabs that must be handled consistently in both development and production environments.

## Data Fetching Implementation
1. **Use SWR for Data Fetching**
   - Always use `useSWR` for data fetching to ensure consistent behavior
   - Properly type the SWR hook: `useSWR<TabData>(settings.sheetUrl, fetchAllTabsData)`
   - Handle loading and error states appropriately

2. **Type Safety**
   - Use proper type assertions when accessing tab data
   - For search terms: `const searchTerms = (tabsData?.searchTerms || []) as SearchTermMetric[]`
   - For daily data: `const dailyData = (tabsData?.daily || []) as AdMetric[]`

## Tab 1: "SearchTerms"
This tab contains search term performance data:

| Header | Type | Description |
|--------|------|-------------|
| searchTerm | string | The actual search query used |
| campaign | string | Campaign name |
| adGroup | string | Ad group name |
| impr | number | Number of ad impressions |
| clicks | number | Number of clicks received |
| cost | number | Cost in account currency (already converted from micros) |
| conv | number | Number of conversions |
| value | number | Total conversion value |
| cpc | number | Cost per click (calculated) |
| ctr | number | Click-through rate (decimal, not percentage) |
| convRate | number | Conversion rate (decimal, not percentage) |
| cpa | number | Cost per acquisition |
| roas | number | Return on ad spend (value/cost) |

## Tab 2: "Daily"
This tab contains daily campaign performance data:

| Header | Type | Description |
|--------|------|-------------|
| campaign | string | Campaign name |
| campaignId | string | Campaign ID (stored as string) |
| clicks | number | Number of clicks received |
| lostBudget | number | Budget lost impression share (decimal) |
| imprShare | number | Impression share (decimal) |
| lostRank | number | Rank lost impression share (decimal) |
| value | number | Conversion value |
| conv | number | Number of conversions |
| cost | number | Cost in account currency (already converted from micros) |
| impr | number | Number of impressions |
| date | string | Date in YYYY-MM-DD format |

## Implementation Notes

1. **Data Types & Parsing**: 
   - Always use type guards when handling data: `isSearchTermMetric` and `isAdMetric`
   - Parse numeric fields with `Number()`: `Number(row['clicks'] || 0)`
   - Use nullish coalescing for defaults: `row['campaign'] || ''`
   - Ensure consistent typing between dev/prod: use `TabData` interface

2. **Percentage Values**: 
   - Store as decimals (0.15 rather than 15%)
   - Format for display using `formatPercent(value * 100)`
   - Key metrics: CTR, conv_rate, imprShare, etc.

3. **Currency Values**: 
   - Use the account's currency setting from context
   - Format using `formatCurrency(value, settings.currency)`
   - Applies to: cost, conversion_value, cpc, cpa

4. **Error Handling**: 
   - Always provide fallback empty arrays: `tabsData?.searchTerms || []`
   - Type check data before processing
   - Log errors in development for debugging

5. **Data Fetching Pattern**:
```typescript
const { data: tabsData, error, isLoading } = useSWR<TabData>(
    settings.sheetUrl,
    fetchAllTabsData
)

// Handle loading and error states
if (error) return <ErrorComponent />
if (isLoading) return <LoadingComponent />

// Type assertion for specific tab data
const data = (tabsData?.targetTab || []) as TargetMetricType[]
```

6. **Sorting and Filtering**: 
   - Implement client-side sorting/filtering
   - Sort numeric values using `Number()` conversion
   - Handle string collation for text fields

7. **Performance Considerations**:
   - Limit displayed rows (e.g., `.slice(0, 10)`)
   - Implement pagination for large datasets
   - Cache data using SWR's built-in caching

Remember: The key to consistent behavior between development and production is proper typing, consistent data fetching patterns, and thorough error handling.

